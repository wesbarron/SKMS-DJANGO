{% extends "site-skeleton.html" %}

{% block body %}

<div class="card row-hover pos-relative py-3 px-3 mb-3 border-warning border-top-0 border-right-0 border-bottom-0 rounded-0">
    <div class="row align-items-center">
    
      <div class="col-md-8 mb-3 mb-sm-0">
        <h5>
          <input type="hidden" value="{{post.id}}" id="post-id" />
          <a href="#" class="text-primary">{{post.title}}</a>
        </h5>
        <p class="text-sm"><span class="op-6">Posted </span>{{post.datetime}} <span class="op-6">by</span> <a class="text-black" href="#">{{post.author}}</a></p>
        <div class="text-sm op-5"> <a class="text-black mr-2" href="#">{{post.content}}</a></div>
        <div class="text-sm op-5"> <a class="text-black mr-2" href="#">{{post.subject}}</a></div>
      </div>
      <div class="col-md-4 op-7">
        <div class="row text-center op-7">
          <p id="post-likes">{{post.likes}}</p>
          
        </div>
      </div>

    </div>
    <div class="d-flex align-content-start">
      <div class="reply-button-div m-2">
        <a href="#reply" class="btn btn-success" id="reply"><i class="fa-solid fa-reply"></i> Reply</a>
      </div>
      <div class="m-2">
        <button id="like-post" class="btn btn-secondary"><i class="fa-solid fa-thumbs-up"></i> Like</button>
      </div>
    </div>
    
  </div>

  <div id="reply-div" style="display:none;">
    <form method="post" action="{% url 'create-comment' post.id %}">
      {% csrf_token %}
    
    <div class="card row-hover pos-relative py-3 px-3 mb-3 border-warning border-top-0 border-right-0 border-bottom-0 rounded-0">
      <div class="row align-items-center">
      
        <div class="col-md-8 mb-3 mb-sm-0">
          
          <div class="op-5"><textarea class="form-control" id="reply-content" name="content"></textarea></div>
        </div>
  
      </div>
      <div class="submit-button-div">
        <button type="submit"  class="btn btn-primary" id="createReply">Submit</a>
      </div>
    
    </div>
  </form>
  </div>
{% for comment in post.post_comments.all %}
  <div class="card row-hover pos-relative py-3 px-3 mb-3 border-warning border-top-0 border-right-0 border-bottom-0 rounded-0">
    <div class="row align-items-center">
    
      <div class="col-md-8 mb-3 mb-sm-0">
        <p class="text-sm"><span class="op-6">Posted </span>{{comment.datetime}} <span class="op-6">by</span> <a class="text-black" href="#">{{comment.author}}</a></p>
        <div class="text-sm op-5"> <a class="text-black mr-2" href="#">{{comment.content}}</a></div>
      </div>
      <div class="col-md-4 op-7">
        <div class="row text-center op-7">
          <div class="col px-1"> <i class="ion-connection-bars icon-1x"></i> <span class="d-block text-sm">0 Likes</span> </div>
        </div>
      </div>

    </div>
  </div>
  {% endfor %}

  {% endblock %}

  {% block script %}
  
  <script>
    $(document).on('click','#reply', function(){
      $('#reply-div').show()
    });
    $(document).on('click', '#like-post', function(){
  var post_id = $('#post-id').val();
  var csrftoken = $("[name=csrfmiddlewaretoken]").val();
  $.ajax({
    url: '/skms/like-post/post_id=' + post_id,
    type: 'POST',
    headers: {
      'X-CSRFToken': csrftoken
    },
    success: function(data){
      $('#post-likes').html(data.likes)
    }
  });
});
    
  </script>
  {% endblock %}